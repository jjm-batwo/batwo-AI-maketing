# /wrap - 작업 마무리 다이제스트

세션을 마무리하며 오늘의 작업을 정리합니다. 아래 5단계를 순서대로 실행하세요.

---

## 1단계: 오늘의 작업 요약

`git diff --stat` 과 `git diff --name-only` 결과를 분석하여 다음을 정리합니다:

- **변경된 파일 목록**: 파일 경로와 변경 유형 (신규/수정/삭제)
- **핵심 로직 변경사항**: 각 파일에서 어떤 로직이 왜 변경되었는지 1-2줄 요약
- **해결된 이슈/버그**: 이번 세션에서 해결한 문제들
- **미해결 사항**: 작업 중 발견했지만 아직 처리하지 못한 것들

아래 형식으로 출력합니다:

```
## 작업 요약 (YYYY-MM-DD)

### 변경 파일 (N개)
| 파일 | 변경 유형 | 설명 |
|------|----------|------|
| path/to/file | 수정 | 변경 내용 요약 |

### 핵심 변경사항
- [기능/버그/리팩토링] 변경 내용 설명

### 해결된 이슈
- 이슈 설명

### 미해결 사항
- (없으면 "없음")
```

---

## 2단계: 규칙/메모리 업데이트

이번 세션에서 배운 내용을 영구 기록에 반영합니다:

1. **에러 패턴**: 반복될 수 있는 에러나 함정을 발견했다면 메모리 파일에 기록
2. **프로젝트 규칙**: 새로운 컨벤션이나 주의사항이 있다면 CLAUDE.md 업데이트 제안
3. **의존성/환경 변화**: 새로 설치한 패키지나 환경 설정 변경사항 기록

업데이트할 내용이 있으면 사용자에게 확인 후 반영합니다.
업데이트할 내용이 없으면 "규칙 업데이트 불필요" 로 표시합니다.

---

## 3단계: 다음 작업 To-Do 리스트

내일 바로 시작할 수 있도록 **P0/P1만** 생성합니다.
P2 항목은 wrap 로그에 포함하지 않고, 4단계에서 `docs/backlog.md`로 이관합니다.

```
## 다음 작업 To-Do

### 우선순위 높음 (P0)
- [ ] 구체적인 작업 내용 (관련 파일: path/to/file)

### 우선순위 보통 (P1)
- [ ] 구체적인 작업 내용
```

- 각 To-Do에는 시작점이 되는 파일 경로를 포함
- 모호한 표현 대신 바로 실행 가능한 액션 아이템으로 작성
- 미해결 사항이 있으면 P0에 포함

---

## 4단계: 백로그 업데이트

`docs/backlog.md` 파일을 읽고 다음을 수행합니다:

### P2 항목 이관
이번 세션에서 새로 발견된 P2 수준 항목을 `docs/backlog.md`에 추가합니다:

- **P2a (블로킹 대기)**: 외부 라이브러리 안정화, 선행 작업 완료 등 조건부 항목
  - 반드시 **블로킹 조건**과 **승격 기준**을 명시
- **P2b (백로그)**: 현재 동작에 문제없지만 여유 있을 때 진행할 최적화/개선
  - 관련 파일과 간단한 비고를 명시

### 완료 항목 정리
이번 세션에서 처리된 백로그 항목이 있으면 `docs/backlog.md`에서 제거합니다.

### wrap 로그에 요약 기록
```
### 백로그 변동
- 신규 이관: N개 (P2a: n개, P2b: n개)
- 완료 제거: N개
- 현재 총: P2a n개, P2b n개 → [docs/backlog.md](../backlog.md)
```

---

## 5단계: 스마트 자동 커밋

wrap 로그 저장 후, 이번 세션의 변경사항을 자동으로 커밋합니다.

### 판단 로직

`git status --porcelain`을 실행하여 변경사항을 분류합니다:

**케이스 A: 변경사항 없음**
- 커밋할 내용이 없습니다. 이 단계를 건너뜁니다.

**케이스 B: 추적 파일만 변경 (untracked 없음)**
- 안전한 변경으로 판단하여 **자동 커밋**합니다.
- 1단계 핵심 변경사항에서 커밋 메시지를 생성합니다.
- `git add -A && git commit` 실행

**케이스 C: 미추적(untracked) 파일이 존재**
- `AskUserQuestion`으로 사용자에게 확인합니다:
  - 미추적 파일 목록을 보여주고
  - 선택지: "전체 커밋" / "추적 파일만 커밋" / "커밋 건너뛰기"
- 사용자 선택에 따라 진행합니다.

### 커밋 메시지 생성 규칙

1단계의 핵심 변경사항을 기반으로 커밋 메시지를 자동 생성합니다:

```
<type>(<scope>): <1줄 요약>

- 변경사항 1
- 변경사항 2

Co-Authored-By: Claude <noreply@anthropic.com>
```

- `type`: feat / fix / refactor / docs / test / chore 중 적절한 것
- `scope`: 주요 변경 영역 (예: meta-api, auth, dashboard)
- 핵심 변경사항에서 가장 중요한 2-3개를 본문에 포함

### 커밋 후 확인

커밋 성공 시 wrap 로그에 커밋 해시를 추가합니다:
```
### 커밋
- 해시: `abc1234`
- 메시지: <커밋 메시지 1줄>
```

---

## 출력 형식

위 5단계 결과를 하나의 깔끔한 마크다운으로 통합하여 출력합니다.
추가로 `docs/wrap-logs/` 디렉토리에 `YYYY-MM-DD.md` 파일로 저장합니다 (디렉토리 없으면 생성).

### 누적 기록 규칙
- 같은 날짜의 로그 파일이 이미 존재하면 **파일 끝에 추가(append)** 합니다.
- 새 세션은 `---` 구분선과 시각 헤더(`## 세션 2 (HH:MM)`)로 구분합니다.
- 기존 내용을 절대 덮어쓰지 않습니다.
