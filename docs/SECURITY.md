# Security Policy

이 문서는 바투(Batow) 서비스의 민감 데이터 보안 정책을 정의합니다.

## 암호화 시스템

### AES-256-GCM 암호화

바투 서비스는 민감한 데이터(예: Meta Ads 액세스 토큰)를 보호하기 위해 AES-256-GCM 암호화를 사용합니다.

**암호화 사양:**
- 알고리즘: AES-256-GCM (Galois/Counter Mode)
- 키 길이: 256비트 (32바이트)
- IV (Initialization Vector): 128비트 (16바이트, 매 암호화마다 무작위 생성)
- 인증 태그: 128비트 (16바이트, 데이터 무결성 검증용)

**암호화 형식:**
```
base64(IV + AuthTag + Ciphertext)
```

### 암호화되는 데이터

| 데이터 유형 | 위치 | 암호화 방식 |
|------------|------|-------------|
| Meta Ads 액세스 토큰 | `MetaAdAccount.accessToken` | AES-256-GCM (자동) |
| Google Ads 액세스 토큰 | `GoogleAdAccount.accessToken` | AES-256-GCM (자동) |
| API 시크릿 | 환경 변수 | 시스템 레벨 보호 |

## 키 관리

### 환경 변수

암호화 키는 `ENCRYPTION_KEY` 환경 변수를 통해 관리됩니다.

**요구사항:**
- 정확히 32바이트(문자)여야 함
- 프로덕션 환경에서는 안전한 비밀 관리 시스템 사용 권장
- 소스 코드에 절대 포함하지 말 것

**키 생성 방법:**
```bash
# Node.js를 사용한 안전한 키 생성
node -e "console.log(require('crypto').randomBytes(32).toString('base64').substring(0, 32))"
```

### 키 로테이션

키 로테이션 시 다음 절차를 따릅니다:

1. 새로운 암호화 키 생성
2. 기존 데이터를 이전 키로 복호화
3. 새 키로 재암호화
4. 환경 변수 업데이트
5. 애플리케이션 재시작

## 데이터 접근 정책

### 접근 제어

- **최소 권한 원칙**: 각 서비스 컴포넌트는 필요한 최소한의 데이터에만 접근
- **역할 기반 접근 제어**: 사용자 역할에 따른 데이터 접근 제한
- **감사 로깅**: 민감 데이터 접근 시 로그 기록

### 데이터 전송

- **TLS 1.3**: 모든 외부 통신은 TLS 1.3 사용
- **API 인증**: JWT 토큰 기반 인증
- **토큰 만료**: 액세스 토큰은 정기적으로 갱신

## 보안 체크리스트

### 개발 환경

- [ ] `.env` 파일이 `.gitignore`에 포함되어 있는지 확인
- [ ] 테스트용 암호화 키가 프로덕션과 분리되어 있는지 확인
- [ ] 민감한 데이터가 로그에 출력되지 않는지 확인

### 프로덕션 환경

- [ ] 환경 변수가 안전하게 관리되는지 확인 (예: AWS Secrets Manager, HashiCorp Vault)
- [ ] 데이터베이스 접근이 VPC 내부로 제한되어 있는지 확인
- [ ] 암호화 키가 주기적으로 로테이션되는지 확인
- [ ] 보안 감사 로그가 활성화되어 있는지 확인

## 사고 대응

### 키 노출 시

1. 즉시 새로운 암호화 키 생성
2. 영향받은 모든 데이터 재암호화
3. 노출된 토큰 무효화 (Meta/Google 대시보드에서)
4. 보안 사고 보고서 작성

### 데이터 유출 시

1. 영향 범위 파악
2. 관련 토큰 즉시 폐기
3. 사용자 알림 (필요시)
4. 근본 원인 분석 및 수정

## 규정 준수

이 보안 정책은 다음 규정을 고려하여 설계되었습니다:

- **GDPR**: EU 일반 데이터 보호 규정
- **PIPA**: 한국 개인정보보호법
- **Meta Platform Policy**: Meta 플랫폼 정책
- **Google API Terms**: Google API 이용약관

## 문의

보안 관련 문의사항이나 취약점 신고는 다음으로 연락해 주세요:
- Email: security@batow.io (예정)
